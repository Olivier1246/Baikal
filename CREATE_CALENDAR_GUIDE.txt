################################################################################
#        GUIDE: CRÃ‰ER UN UTILISATEUR ET UN CALENDRIER DANS BAÃKAL             #
################################################################################

PROBLÃˆME
========

Message dans Thunderbird:
  "Aucun agenda Ã  cette adresse, veuillez vÃ©rifier les paramÃ¨tres"

URL testÃ©e:
  https://caldav.maison-oadf.ddns.net/dav.php/calendars/Olivier/my-calendar/

DIAGNOSTIC
==========

Ce message signifie que le calendrier N'EXISTE PAS dans BaÃ¯kal.

Deux possibilitÃ©s:
  1. L'utilisateur existe mais le calendrier n'a pas Ã©tÃ© crÃ©Ã©
  2. L'URL ne correspond pas au calendrier rÃ©el (casse, nom diffÃ©rent)

Ã‰TAPE 1: VÃ‰RIFIER CE QUI EXISTE
================================

Lancer le script de diagnostic:

cd ~/baikal-install
chmod +x list_baikal_users_calendars.sh
sudo ./list_baikal_users_calendars.sh

Ce script affiche:
  âœ“ Tous les utilisateurs
  âœ“ Tous les calendriers de chaque utilisateur
  âœ“ Les URLs CalDAV exactes Ã  utiliser
  âœ“ Le nombre d'Ã©vÃ©nements dans chaque calendrier

RÃ‰SULTATS POSSIBLES:

1. L'utilisateur "Olivier" existe MAIS aucun calendrier
   â†’ Il faut CRÃ‰ER un calendrier (voir Ã‰TAPE 2)

2. L'utilisateur s'appelle "olivier" (minuscule) pas "Olivier"
   â†’ Utiliser la bonne casse dans l'URL

3. Le calendrier s'appelle "default" pas "my-calendar"
   â†’ Utiliser le bon nom dans l'URL

4. Rien n'existe
   â†’ CrÃ©er l'utilisateur ET le calendrier (voir Ã‰TAPE 2 et 3)

Ã‰TAPE 2: CRÃ‰ER UN UTILISATEUR DANS BAÃKAL
==========================================

1. Se connecter Ã  l'interface admin:
   https://caldav.maison-oadf.ddns.net/admin/

2. Identifiants par dÃ©faut (si premier accÃ¨s):
   - Utilisateur: admin
   - Mot de passe: celui dÃ©fini lors de l'installation

3. Dans le menu, cliquer sur "Utilisateurs & Ressources"

4. Cliquer sur le bouton "+ Ajouter un utilisateur"

5. Remplir le formulaire:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Utilisateur: olivier                        â”‚  â† IMPORTANT: en minuscules
   â”‚ Nom complet: Olivier                        â”‚
   â”‚ Email: olivier@example.com                  â”‚
   â”‚ Mot de passe: ************                  â”‚
   â”‚ Confirmer: ************                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   âš ï¸ ATTENTION Ã€ LA CASSE:
   - L'identifiant "olivier" (minuscule) est diffÃ©rent de "Olivier"
   - PrÃ©fÃ©rez TOUJOURS les minuscules pour l'identifiant
   - Le nom complet peut avoir des majuscules

6. Cliquer sur "Enregistrer"

Ã‰TAPE 3: CRÃ‰ER UN CALENDRIER POUR L'UTILISATEUR
================================================

IMPORTANT: Un utilisateur seul ne suffit pas, il faut lui crÃ©er un calendrier !

1. Toujours dans "Utilisateurs & Ressources"

2. Cliquer sur l'utilisateur que vous venez de crÃ©er (ex: olivier)

3. Descendre jusqu'Ã  la section "Calendriers"

4. Cliquer sur "+ Ajouter un calendrier"

5. Remplir le formulaire:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ URI du calendrier: default                  â”‚  â† Identifiant unique
   â”‚ Nom d'affichage: Mon Calendrier             â”‚  â† Nom visible
   â”‚ Description: Calendrier personnel           â”‚
   â”‚ Couleur: #3498db (bleu)                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Recommandations pour l'URI:
   âœ“ "default" (nom par dÃ©faut, simple)
   âœ“ "personal" (calendrier personnel)
   âœ“ "work" (calendrier travail)
   âœ“ "family" (calendrier famille)
   
   âœ— "my-calendar" (trait d'union parfois problÃ©matique)
   âœ— "Mon Calendrier" (espaces et accents problÃ©matiques)

6. Cliquer sur "Enregistrer"

7. L'URL CalDAV complÃ¨te sera:
   https://caldav.maison-oadf.ddns.net/dav.php/calendars/olivier/default/
   
   Format gÃ©nÃ©ral:
   https://[domaine]/dav.php/calendars/[utilisateur]/[uri-calendrier]/

Ã‰TAPE 4: NOTER L'URL EXACTE
============================

AprÃ¨s crÃ©ation, BaÃ¯kal affiche l'URL dans l'interface:

Exemple:
  ğŸ“… Calendrier: default
     Nom: Mon Calendrier
     URL: https://caldav.maison-oadf.ddns.net/dav.php/calendars/olivier/default/

C'est CETTE URL qu'il faut copier dans Thunderbird !

Ã‰TAPE 5: CONFIGURER THUNDERBIRD
================================

Maintenant que le calendrier existe:

1. Dans Thunderbird, aller dans l'onglet "Agenda"

2. Clic droit dans la liste des calendriers â†’ "Nouveau calendrier..."

3. SÃ©lectionner "Sur le rÃ©seau" â†’ Suivant

4. Choisir "CalDAV"

5. Entrer:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Utilisateur: olivier                        â”‚  â† Identifiant BaÃ¯kal
   â”‚                                             â”‚
   â”‚ Emplacement:                                â”‚
   â”‚ https://caldav.maison-oadf.ddns.net/       â”‚
   â”‚ dav.php/calendars/olivier/default/          â”‚  â† URL COMPLÃˆTE du calendrier
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6. Cliquer sur "Suivant"

7. Thunderbird demandera le mot de passe
   â†’ Entrer le mot de passe de l'utilisateur BaÃ¯kal

8. Le calendrier devrait apparaÃ®tre dans la liste !

ERREURS COURANTES
=================

ERREUR: "Aucun agenda Ã  cette adresse"
CAUSE: Le calendrier n'existe pas ou l'URL est incorrecte
SOLUTION: VÃ©rifier avec ./list_baikal_users_calendars.sh

ERREUR: "Erreur d'authentification"
CAUSE: Identifiant ou mot de passe incorrect
SOLUTION: VÃ©rifier les identifiants dans BaÃ¯kal admin

ERREUR: "MODIFICATION_FAILED"
CAUSE: Permissions serveur ou calendrier en lecture seule
SOLUTION: ./fix_caldav_permissions.sh

ERREUR: URL avec "Olivier" (majuscule) ne fonctionne pas
CAUSE: L'utilisateur s'appelle "olivier" (minuscule)
SOLUTION: Respecter la casse exacte

VÃ‰RIFICATION AVEC CURL
======================

Pour tester si le calendrier existe:

# Remplacez olivier et default par vos valeurs rÃ©elles
curl -u 'olivier:votre_mot_de_passe' -X PROPFIND \
  -H 'Depth: 1' \
  https://caldav.maison-oadf.ddns.net/dav.php/calendars/olivier/default/

RÃ‰SULTATS:
  - Du XML avec des informations = âœ“ Calendrier existe
  - "404 Not Found" = âœ— Calendrier n'existe pas
  - "401 Unauthorized" = âœ— Mauvais identifiants

CRÃ‰ER PLUSIEURS CALENDRIERS
============================

Vous pouvez crÃ©er plusieurs calendriers pour un mÃªme utilisateur:

1. Dans BaÃ¯kal admin â†’ Utilisateurs & Ressources â†’ [utilisateur]

2. Section "Calendriers" â†’ "+ Ajouter un calendrier"

3. CrÃ©er par exemple:
   - URI: "personal" â†’ Calendrier personnel
   - URI: "work" â†’ Calendrier travail
   - URI: "family" â†’ Calendrier famille

4. Chaque calendrier aura sa propre URL:
   - https://caldav.maison-oadf.ddns.net/dav.php/calendars/olivier/personal/
   - https://caldav.maison-oadf.ddns.net/dav.php/calendars/olivier/work/
   - https://caldav.maison-oadf.ddns.net/dav.php/calendars/olivier/family/

5. Dans Thunderbird, ajouter chaque calendrier sÃ©parÃ©ment

CARNETS D'ADRESSES (CARDDAV)
=============================

MÃªme principe pour les contacts:

1. Dans BaÃ¯kal admin â†’ Utilisateurs & Ressources â†’ [utilisateur]

2. Section "Carnets d'adresses" â†’ "+ Ajouter un carnet d'adresses"

3. Remplir:
   - URI: "default"
   - Nom: "Mes Contacts"

4. URL CardDAV:
   https://caldav.maison-oadf.ddns.net/dav.php/addressbooks/olivier/default/

5. Dans Thunderbird:
   - Carnet d'adresses â†’ Nouveau carnet d'adresses
   - CardDAV
   - Entrer l'URL

BONNES PRATIQUES
================

âœ“ Utilisez des identifiants en MINUSCULES (olivier, admin, john)
âœ“ Utilisez des URI simples pour les calendriers (default, work, personal)
âœ“ Ã‰vitez les espaces, accents, traits d'union dans les URI
âœ“ CrÃ©ez toujours au moins un calendrier "default" par utilisateur
âœ“ Testez avec curl avant de configurer Thunderbird
âœ“ Notez les URLs exactes quelque part

âœ— N'utilisez pas de majuscules dans les identifiants
âœ— N'utilisez pas d'espaces ou accents dans les URI
âœ— Ne crÃ©ez pas d'utilisateur sans calendrier

CHECKLIST DE CRÃ‰ATION
======================

â˜ Connexion Ã  l'interface admin BaÃ¯kal
â˜ Utilisateur crÃ©Ã© (identifiant en minuscules)
â˜ Au moins un calendrier crÃ©Ã© pour cet utilisateur
â˜ URL CalDAV notÃ©e (copier depuis l'interface)
â˜ Test curl rÃ©ussi
â˜ Configuration dans Thunderbird avec l'URL exacte
â˜ Ã‰vÃ©nement de test crÃ©Ã© et synchronisÃ©

RÃ‰SUMÃ‰ RAPIDE
=============

1. DIAGNOSTIC:
   sudo ./list_baikal_users_calendars.sh

2. CRÃ‰ER UTILISATEUR:
   Admin BaÃ¯kal â†’ Utilisateurs & Ressources â†’ + Ajouter utilisateur
   Identifiant: olivier (minuscules !)

3. CRÃ‰ER CALENDRIER:
   Cliquer sur l'utilisateur â†’ Calendriers â†’ + Ajouter calendrier
   URI: default

4. NOTER L'URL:
   https://caldav.maison-oadf.ddns.net/dav.php/calendars/olivier/default/

5. THUNDERBIRD:
   Nouveau calendrier â†’ CalDAV â†’ Coller l'URL exacte

6. TESTER:
   CrÃ©er un Ã©vÃ©nement dans Thunderbird

COMMANDES UTILES
================

# Lister tout ce qui existe
sudo ./list_baikal_users_calendars.sh

# Tester l'accÃ¨s au calendrier
curl -u 'olivier:password' -X PROPFIND \
  -H 'Depth: 1' \
  https://caldav.maison-oadf.ddns.net/dav.php/calendars/olivier/default/

# Corriger les permissions si nÃ©cessaire
sudo ./fix_caldav_permissions.sh

# Surveiller les logs
sudo tail -f /var/log/nginx/baikal_error.log

================================================================================

La clÃ© du succÃ¨s: CRÃ‰ER LE CALENDRIER dans BaÃ¯kal avant de le configurer dans
Thunderbird !

Un utilisateur seul ne suffit pas, il faut lui crÃ©er au moins un calendrier.
================================================================================
